@baseUrl = http://localhost:8081
@admin_username = adm23
@admin_password = admin123

# –î–ª—è –≤–µ—Ä–∏—Ñ—ñ–∫–∞—Ü—ñ—ó –∑ –±–æ–∫—É –∑–≤–∏—á–∞–π–Ω–æ–≥–æ —é–∑–µ—Ä–∞ (–æ–ø—Ü—ñ–π–Ω–æ).
# –¶–ï –ù–ï –ü–Ü–î–ü–ò–°–ö–ê –ß–ï–†–ï–ó REST ‚Äî –ø—ñ–¥–ø–∏—Å–∫–∞ –±—É–¥–µ –õ–ò–®–ï —á–µ—Ä–µ–∑ Telegram –∫–Ω–æ–ø–∫—É.
@user_username = user1122
@user_password = user123

# –ö–∞–Ω–∞–ª/—á–∞—Ç –¥–ª—è –ø—É–±–ª—ñ—á–Ω–æ–≥–æ –ø–æ—Å—Ç–∞ (–Ω–∞–ø—Ä–∏–∫–ª–∞–¥ -1003137847951).
@tg_channel_chat_id = -1003137847951

### 0) –û–±—á–∏—Å–ª—é—î–º–æ —á–∞—Å–∏ (now, post1, post2, startAt, remindAt)
GET {{baseUrl}}/

> {%
    function iso(d){
        const z = new Date(d.getTime() - d.getTimezoneOffset()*60000);
        return z.toISOString().slice(0,19); // "YYYY-MM-DDTHH:mm:ss"
    }
    const now    = new Date();
    const post1  = new Date(now.getTime() + 1*60000);  // +1 —Ö–≤ ‚Äî –ø–µ—Ä—à–∏–π –ø—É–±–ª—ñ—á–Ω–∏–π –ø–æ—Å—Ç
    const post2  = new Date(now.getTime() + 2*60000);  // +2 —Ö–≤ ‚Äî –¥—Ä—É–≥–∏–π –ø—É–±–ª—ñ—á–Ω–∏–π –ø–æ—Å—Ç
    const start  = new Date(now.getTime() + 7*60000);  // +7 —Ö–≤ ‚Äî –ø–æ—á–∞—Ç–æ–∫ —ñ–≤–µ–Ω—Ç–∞
    const remind = new Date(start.getTime() - 5*60000);// —Å—Ç–∞—Ä—Ç - 5 —Ö–≤ ‚Äî DM-–Ω–∞–≥–∞–¥—É–≤–∞–Ω–Ω—è

    client.global.set("now_iso",        iso(now));
    client.global.set("post1_at",       iso(post1));
    client.global.set("post2_at",       iso(post2));
    client.global.set("event_start_at", iso(start));
    client.global.set("remind_at",      iso(remind));
%}

### 1) –†–µ—î—Å—Ç—Ä–∞—Ü—ñ—è –ê–î–ú–Ü–ù–ê (—è–∫—â–æ –≤–∂–µ —î ‚Äî 409, —Ç–æ–¥—ñ 1.1)
POST {{baseUrl}}/api/v1/auth/register
Content-Type: application/json

{
  "username": "{{admin_username}}",
  "password": "{{admin_password}}",
  "role": "admin"
}
> {%
    client.global.set("admin_access_token", response.body.accessToken || (response.body.user && response.body.user.accessToken));
%}

### 1.1) (fallback) –õ–æ–≥—ñ–Ω –ê–î–ú–Ü–ù–ê
POST {{baseUrl}}/api/v1/auth/login
Content-Type: application/json

{
  "username": "{{admin_username}}",
  "password": "{{admin_password}}"
}
> {%
    if (response.body && response.body.accessToken) {
        client.global.set("admin_access_token", response.body.accessToken);
    }
%}

### 2) –°—Ç–≤–æ—Ä—é—î–º–æ —ñ–≤–µ–Ω—Ç (—Å—Ç–∞—Ä—Ç —á–µ—Ä–µ–∑ 7 —Ö–≤). –ü–æ–ª–µ "url" —É–≤—ñ–º–∫–Ω–µ –¥—Ä—É–≥—É –∫–Ω–æ–ø–∫—É-–ª—ñ–Ω–∫ —É TG-–ø–æ—Å—Ç—ñ.
POST {{baseUrl}}/api/v1/events
Authorization: Bearer {{admin_access_token}}
Content-Type: application/json

{
  "name": "Pereviro4ka",
  "startAt": "{{event_start_at}}",
  "location": "Sport Hall",
  "capacity": 20,
  "description": "–ü–µ—Ä–µ–≤—ñ—Ä–∫–∞ TG-–Ω–∞–≥–∞–¥—É–≤–∞–Ω–Ω—è —Ç–∞ –∫–Ω–æ–ø–∫–∏-–ª—ñ–Ω–∫–∞",
  "category": "SPORTS",
  "tags": ["tg","reminder","e2e"],
  "coverUrl": "https://example.com/tickets"
}
> {%
    client.global.set("event_id", response.body.id);
%}

### 2.1) –ü–µ—Ä–µ–≤—ñ—Ä—è—î–º–æ —Å—Ç–≤–æ—Ä–µ–Ω–∏–π —ñ–≤–µ–Ω—Ç
GET {{baseUrl}}/api/v1/events/{{event_id}}
Authorization: Bearer {{admin_access_token}}

### 3) –ü—É–±–ª—ñ—á–Ω–∏–π –ø–æ—Å—Ç #1 —É –∫–∞–Ω–∞–ª (SCHEDULED –Ω–∞ +1 —Ö–≤).
# –£ Telegram –º–∞—î –±—É—Ç–∏ –∫–Ω–æ–ø–∫–∞ "–ó–∞—Ä–µ—î—Å—Ç—Ä—É–≤–∞—Ç–∏—Å—è" + –∫–Ω–æ–ø–∫–∞-–ª—ñ–Ω–∫ —ñ–∑ url —ñ–≤–µ–Ω—Ç–∞.
POST {{baseUrl}}/api/v1/events/{{event_id}}/posts
Authorization: Bearer {{admin_access_token}}
Content-Type: application/json

{
  "title": "–ó–º–∞–≥–∞–Ω–Ω—è —Å–∫–æ—Ä–æ! –ù–∞—Ç–∏—Å–Ω—ñ—Ç—å, —â–æ–± –∑–∞—Ä–µ—î—Å—Ç—Ä—É–≤–∞—Ç–∏—Å—è",
  "body": "–†–µ—î—Å—Ç—Ä–∞—Ü—ñ—è –≤ 1 –∫–ª—ñ–∫. –ù–∞–≥–∞–¥—É–≤–∞–Ω–Ω—è –ø—Ä–∏–π–¥–µ –ø–µ—Ä–µ–¥ —Å—Ç–∞—Ä—Ç–æ–º.",
  "publishAt": "{{post1_at}}",
  "audience": "PUBLIC",
  "channel": "TELEGRAM",
  "status": "SCHEDULED",
  "telegramChatId": "{{tg_channel_chat_id}}"
}
> {%
    client.global.set("post_id_public_1", response.body.id);
%}

### 3.1) –ü—É–±–ª—ñ—á–Ω–∏–π –ø–æ—Å—Ç #2 –¥–ª—è —Ç–æ–≥–æ –∂ —ñ–≤–µ–Ω—Ç–∞ (SCHEDULED –Ω–∞ +2 —Ö–≤).
POST {{baseUrl}}/api/v1/events/{{event_id}}/posts
Authorization: Bearer {{admin_access_token}}
Content-Type: application/json

{
  "title": "–î–æ–¥–∞—Ç–∫–æ–≤–∏–π –∞–Ω–æ–Ω—Å: –º—ñ—Å—Ü—å –æ–±–º–µ–∂–µ–Ω–æ",
  "body": "–ù–µ –∑–≤–æ–ª—ñ–∫–∞–π ‚Äî –∑–∞—Ä–µ—î—Å—Ç—Ä—É–π—Å—è –∑–∞—Ä–∞–∑. –°—Ç–∞—Ä—Ç –æ {{event_start_at}}.",
  "publishAt": "{{post2_at}}",
  "audience": "PUBLIC",
  "channel": "TELEGRAM",
  "status": "SCHEDULED",
  "telegramChatId": "{{tg_channel_chat_id}}"
}
> {%
    client.global.set("post_id_public_2", response.body.id);
%}

### 3.2) –°–∞–Ω—ñ—Ç—ñ: —Å–ø–∏—Å–æ–∫ SCHEDULED TELEGRAM-–ø–æ—Å—Ç—ñ–≤ (–æ—á—ñ–∫—É—î–º–æ 2 –ø—É–±–ª—ñ—á–Ω—ñ)
GET {{baseUrl}}/api/v1/events/{{event_id}}/posts?status=SCHEDULED&channel=TELEGRAM
Authorization: Bearer {{admin_access_token}}

### 4) [–î–Ü–Ø –í TELEGRAM] –ö–æ–ª–∏ –ø–æ—Å—Ç #1 –æ–ø—É–±–ª—ñ–∫—É—î—Ç—å—Å—è ‚Äî –Ω–∞—Ç–∏—Å–Ω–∏ "–ó–∞—Ä–µ—î—Å—Ç—Ä—É–≤–∞—Ç–∏—Å—è".
# –¶–ï–ô –ö–†–û–ö –†–û–ë–ò–® –£ –¢–ï–õ–ï–ì–†–ê–ú. –î–∞–ª—ñ –∑–∞–ø—É—Å–∫–∞–π –ø–µ—Ä–µ–≤—ñ—Ä–∫–∏ 4.1 / 4.2.

### 4.1) –ü–µ—Ä–µ–≤—ñ—Ä–∫–∞ —è–∫ –ê–î–ú–Ü–ù: —Å–ø–∏—Å–æ–∫ –ø—ñ–¥–ø–∏—Å–Ω–∏–∫—ñ–≤ —ñ–≤–µ–Ω—Ç–∞ (–≤–∞—Ä—ñ–∞–Ω—Ç –ê ‚Äî subscribers)
# –û–±–µ—Ä–∏ —Ç–æ–π —à–ª—è—Ö, —è–∫–∏–π —î —É —Ç–≤–æ—î–º—É –±–µ–∫–µ–Ω–¥—ñ.
GET {{baseUrl}}/api/v1/events/{{event_id}}/subscribers
Authorization: Bearer {{admin_access_token}}

### 4.2) –ü–µ—Ä–µ–≤—ñ—Ä–∫–∞ —è–∫ –ê–î–ú–Ü–ù: —Å–ø–∏—Å–æ–∫ –ø—ñ–¥–ø–∏—Å–æ–∫ –Ω–∞ —ñ–≤–µ–Ω—Ç (–≤–∞—Ä—ñ–∞–Ω—Ç –ë ‚Äî subscriptions)
# –Ø–∫—â–æ —É –ø—Ä–æ—î–∫—Ç—ñ —ñ–Ω—à–∞ –Ω–∞–∑–≤–∞ —Ä–æ—É—Ç–∞ ‚Äî –≤–∏–∫–æ—Ä–∏—Å—Ç–∞–π —ó—ó.
GET {{baseUrl}}/api/v1/events/{{event_id}}/subscriptions
Authorization: Bearer {{admin_access_token}}

### 4.3) (–û–ø—Ü—ñ–æ–Ω–∞–ª—å–Ω–æ) –ü–µ—Ä–µ–≤—ñ—Ä–∫–∞ –≤—ñ–¥ —ñ–º–µ–Ω—ñ –Æ–ó–ï–†–ê —á–µ—Ä–µ–∑ REST (–ª–∏—à–µ —è–∫—â–æ –º–∞—î—à —Ç–æ–∫–µ–Ω —é–∑–µ—Ä–∞)
# –¶–µ –Ω–µ —Å—Ç–≤–æ—Ä—é—î –ø—ñ–¥–ø–∏—Å–∫—É ‚Äî –ª–∏—à–µ –ø–æ–∫–∞–∑—É—î, —â–æ –≤–æ–Ω–∞ –∑'—è–≤–∏–ª–∞—Å—å –ø—ñ—Å–ª—è –∫–ª—ñ–∫—É –≤ Telegram.
POST {{baseUrl}}/api/v1/auth/register
Content-Type: application/json

{
  "username": "{{user_username}}",
  "password": "{{user_password}}",
  "role": "user"
}
> {%
    client.global.set("user_access_token", response.body.accessToken || (response.body.user && response.body.user.accessToken));
%}

### 4.3.1) (fallback) –õ–æ–≥—ñ–Ω –Æ–ó–ï–†–ê
POST {{baseUrl}}/api/v1/auth/login
Content-Type: application/json

{
  "username": "{{user_username}}",
  "password": "{{user_password}}"
}
> {%
    if (response.body && response.body.accessToken) {
        client.global.set("user_access_token", response.body.accessToken);
    }
%}

### 4.3.2) (–æ–ø—Ü—ñ–π–Ω–æ) –ü–µ—Ä–µ–≤—ñ—Ä–∏—Ç–∏ –ø—ñ–¥–ø–∏—Å–∫–∏ —é–∑–µ—Ä–∞
GET {{baseUrl}}/api/v1/me/subscriptions
Authorization: Bearer {{user_access_token}}

### 5) –°—Ç–≤–æ—Ä—é—î–º–æ DM-–Ω–∞–≥–∞–¥—É–≤–∞–Ω–Ω—è –¥–ª—è –ü–Ü–î–ü–ò–°–ù–ò–ö–Ü–í (publishAt = startAt - 5 —Ö–≤)
# –¶–µ –ø–æ–≤—ñ–¥–æ–º–ª–µ–Ω–Ω—è –ø—Ä–∏–π–¥–µ —É –ø—Ä–∏–≤–∞—Ç–Ω—ñ –ø–æ–≤—ñ–¥–æ–º–ª–µ–Ω–Ω—è –≤—Å—ñ–º, —Ö—Ç–æ –ø—ñ–¥–ø–∏—Å–∞–≤—Å—è —á–µ—Ä–µ–∑ Telegram-–∫–Ω–æ–ø–∫—É.
POST {{baseUrl}}/api/v1/events/{{event_id}}/posts
Authorization: Bearer {{admin_access_token}}
Content-Type: application/json

{
  "title": "üîî –ù–∞–≥–∞–¥—É–≤–∞–Ω–Ω—è: —Å—Ç–∞—Ä—Ç –∑–∞ 5 —Ö–≤",
  "body": "–ü–æ–¥—ñ—è –ø–æ—á–∏–Ω–∞—î—Ç—å—Å—è –æ {{event_start_at}}. –î–æ –∑—É—Å—Ç—Ä—ñ—á—ñ!",
  "publishAt": "{{remind_at}}",
  "audience": "SUBSCRIBERS",
  "channel": "TELEGRAM",
  "status": "SCHEDULED"
}
> {%
    client.global.set("post_id_reminder", response.body.id);
%}

### 5.1) –°–∞–Ω—ñ—Ç—ñ: —Ç–µ–ø–µ—Ä —Å–µ—Ä–µ–¥ SCHEDULED TELEGRAM-–ø–æ—Å—Ç—ñ–≤ –º–∞—î –±—É—Ç–∏ —â–µ –π SUBSCRIBERS-–Ω–∞–≥–∞–¥—É–≤–∞–Ω–Ω—è
GET {{baseUrl}}/api/v1/events/{{event_id}}/posts?status=SCHEDULED&channel=TELEGRAM
Authorization: Bearer {{admin_access_token}}

### 6) –ü–µ—Ä–µ–≤—ñ—Ä—è—î–º–æ —Å—Ç–∞—Ç—É—Å–∏ –ø–æ—Å—Ç—ñ–≤ –ø–æ ID (–¥–æ/–ø—ñ—Å–ª—è —ó—Ö publishAt)
# –ü—É–±–ª—ñ—á–Ω–∏–π –ø–æ—Å—Ç #1
GET {{baseUrl}}/api/v1/events/{{event_id}}/posts/{{post_id_public_1}}
Authorization: Bearer {{admin_access_token}}

# –ü—É–±–ª—ñ—á–Ω–∏–π –ø–æ—Å—Ç #2
GET {{baseUrl}}/api/v1/events/{{event_id}}/posts/{{post_id_public_2}}
Authorization: Bearer {{admin_access_token}}

# DM-–Ω–∞–≥–∞–¥—É–≤–∞–Ω–Ω—è –¥–ª—è –ø—ñ–¥–ø–∏—Å–Ω–∏–∫—ñ–≤
GET {{baseUrl}}/api/v1/events/{{event_id}}/posts/{{post_id_reminder}}
Authorization: Bearer {{admin_access_token}}

### 6.1) (–û–ø—Ü—ñ–æ–Ω–∞–ª—å–Ω–æ) –í—Å—ñ TELEGRAM-–ø–æ—Å—Ç–∏ –∑—ñ —Å—Ç–∞—Ç—É—Å–æ–º PUBLISHED
GET {{baseUrl}}/api/v1/events/{{event_id}}/posts?status=PUBLISHED&channel=TELEGRAM
Authorization: Bearer {{admin_access_token}}

### 6.2) (–û–ø—Ü—ñ–æ–Ω–∞–ª—å–Ω–æ) –í—Å—ñ TELEGRAM-–ø–æ—Å—Ç–∏ –∑—ñ —Å—Ç–∞—Ç—É—Å–æ–º FAILED
GET {{baseUrl}}/api/v1/events/{{event_id}}/posts?status=FAILED&channel=TELEGRAM
Authorization: Bearer {{admin_access_token}}
