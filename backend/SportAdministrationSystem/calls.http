@baseUrl = http://localhost:8081
@admin_username = admin12313213
@admin_password = admin123
# –ó–∞ –ø–æ—Ç—Ä–µ–±–∏: –∫–∞–Ω–∞–ª/—á–∞—Ç –¥–ª—è –ø—É–±–ª—ñ—á–Ω–æ–≥–æ –ø–æ—Å—Ç–∞ (ID –∫–∞–Ω–∞–ª—É, –Ω–∞–ø—Ä–∏–∫–ª–∞–¥ -100xxxxxxxxxx, –∞–±–æ –ø–æ—Ä–æ–∂–Ω—å–æ ‚Äî –≤—ñ–∑—å–º–µ—Ç—å—Å—è –∑ application.yml)
@tg_channel_chat_id = -1003137847951

### 0) –û–±—á–∏—Å–ª—é—î–º–æ —á–∞—Å–∏
### 0) –û–±—á–∏—Å–ª—é—î–º–æ —á–∞—Å–∏
GET {{baseUrl}}/

> {%
    function iso(d){ const z=new Date(d.getTime()-d.getTimezoneOffset()*60000); return z.toISOString().slice(0,19); }
    const now = new Date();
    const postAt = new Date(now.getTime() + 1*60000);   // +1 —Ö–≤
    const start  = new Date(now.getTime() + 7*60000);   // +7 —Ö–≤
    const remind = new Date(start.getTime() - 5*60000); // —Å—Ç–∞—Ä—Ç - 5 —Ö–≤
    client.global.set("now_iso", iso(now));
    client.global.set("post_at", iso(postAt));
    client.global.set("event_start_at", iso(start));
    client.global.set("remind_at", iso(remind));
%}
### 1) –†–µ—î—Å—Ç—Ä–∞—Ü—ñ—è –ê–î–ú–Ü–ù–ê (–∞–±–æ –∑–∞–ª–æ–≥—ñ–Ω–∏—Ç–∏—Å—å, —è–∫—â–æ 409)
POST {{baseUrl}}/api/v1/auth/register
Content-Type: application/json

{
  "username": "{{admin_username}}",
  "password": "{{admin_password}}",
  "role": "admin"
}
> {%
    client.global.set("admin_access_token", response.body.accessToken || (response.body.user && response.body.user.accessToken));
%}

### 1.1) (—è–∫—â–æ 409) Login ADMIN
 POST {{baseUrl}}/api/v1/auth/login
    Content-Type: application/json

{ "username":"{{admin_username}}", "password":"{{admin_password}}" }
> {%
    client.global.set("admin_access_token", response.body.accessToken);
%}

### 2) –°—Ç–≤–æ—Ä—é—î–º–æ –ø–æ–¥—ñ—é (—Å—Ç–∞—Ä—Ç —á–µ—Ä–µ–∑ 7 —Ö–≤)
POST {{baseUrl}}/api/v1/events
Authorization: Bearer {{admin_access_token}}
Content-Type: application/json

{
  "name": "TG Reminder E2E",
  "startAt": "{{event_start_at}}",
  "location": "Sport Hall",
  "capacity": 100,
  "description": "–ï2–ï –ø–µ—Ä–µ–≤—ñ—Ä–∫–∞ TG-–Ω–∞–≥–∞–¥—É–≤–∞–Ω–Ω—è",
  "category": "SPORTS",
  "tags": ["tg","reminder","e2e"]
}
> {%
    client.global.set("event_id", response.body.id);
%}

### 2.1) –ü–µ—Ä–µ–≤—ñ—Ä—è—î–º–æ —ñ–≤–µ–Ω—Ç
GET {{baseUrl}}/api/v1/events/{{event_id}}
Authorization: Bearer {{admin_access_token}}

### 3) –ü—É–±–ª—ñ—á–Ω–∏–π –ø–æ—Å—Ç —É –∫–∞–Ω–∞–ª —ñ–∑ –∫–Ω–æ–ø–∫–æ—é ‚Äú–ó–∞—Ä–µ—î—Å—Ç—Ä—É–≤–∞—Ç–∏—Å—è‚Äù (SCHEDULED —á–µ—Ä–µ–∑ 1 —Ö–≤)
POST {{baseUrl}}/api/v1/events/{{event_id}}/posts
Authorization: Bearer {{admin_access_token}}
Content-Type: application/json

{
  "title": "–ó–º–∞–≥–∞–Ω–Ω—è —Å–∫–æ—Ä–æ! –ù–∞—Ç–∏—Å–Ω—ñ—Ç—å, —â–æ–± –∑–∞—Ä–µ—î—Å—Ç—Ä—É–≤–∞—Ç–∏—Å—è",
  "body": "–†–µ—î—Å—Ç—Ä–∞—Ü—ñ—è –≤ 1 –∫–ª—ñ–∫. –ù–∞–≥–∞–¥—É–≤–∞–Ω–Ω—è –ø—Ä–∏–π–¥–µ –ø–µ—Ä–µ–¥ —Å—Ç–∞—Ä—Ç–æ–º.",
  "publishAt": "{{post_at}}",
  "audience": "PUBLIC",
  "channel": "TELEGRAM",
  "status": "SCHEDULED",
  "telegramChatId": "{{tg_channel_chat_id}}"
}
> {%
    client.global.set("post_id_public", response.body.id);
%}

### 4) –°—Ç–≤–æ—Ä—é—î–º–æ DM-–Ω–∞–≥–∞–¥—É–≤–∞–Ω–Ω—è –¥–ª—è –ø—ñ–¥–ø–∏—Å–Ω–∏–∫—ñ–≤ (startAt - 5 —Ö–≤)
POST {{baseUrl}}/api/v1/events/{{event_id}}/posts
Authorization: Bearer {{admin_access_token}}
Content-Type: application/json

{
  "title": "üîî –ù–∞–≥–∞–¥—É–≤–∞–Ω–Ω—è: —Å—Ç–∞—Ä—Ç –∑–∞ 5 —Ö–≤",
  "body": "–ü–æ–¥—ñ—è –ø–æ—á–∏–Ω–∞—î—Ç—å—Å—è –æ {{event_start_at}}. –î–æ –∑—É—Å—Ç—Ä—ñ—á—ñ!",
  "publishAt": "{{remind_at}}",
  "audience": "SUBSCRIBERS",
  "channel": "TELEGRAM",
  "status": "SCHEDULED"
}
> {%
    client.global.set("post_id_reminder", response.body.id);
%}

### 4.1) –°–∞–Ω—ñ—Ç—ñ: —Å–ø–∏—Å–æ–∫ SCHEDULED –ø–µ—Ä–µ–¥ —Ä–æ–∑—Å–∏–ª–∫–æ—é
GET {{baseUrl}}/api/v1/events/{{event_id}}/posts?status=SCHEDULED&channel=TELEGRAM
Authorization: Bearer {{admin_access_token}}

### 5) (–û–ø—Ü—ñ–æ–Ω–∞–ª—å–Ω–æ, —è–∫—â–æ scheduler —â–µ –Ω–µ –ø—ñ–¥–Ω—è–≤) ‚Äî —Ä—É—á–Ω–∏–π ‚Äú—Ç–∏–∫‚Äù –¥–∏—Å–ø–∞—Ç—á–µ—Ä–∞
# POST {{baseUrl}}/api/v1/events/{{event_id}}/posts/_dispatch-tick
# Authorization: Bearer {{admin_access_token}}

### 6) –ü—ñ—Å–ª—è –ø–æ—è–≤–∏ –ø–æ—Å—Ç–∞ –≤ –∫–∞–Ω–∞–ª—ñ ‚Äî –Ω–∞—Ç–∏—Å–Ω–∏ ‚Äú‚úÖ –ó–∞—Ä–µ—î—Å—Ç—Ä—É–≤–∞—Ç–∏—Å—è‚Äù, –¥–∞–ª—ñ /start —É –±–æ—Ç—ñ.
# (–¶–µ —Ä—É—á–Ω–∏–π –∫—Ä–æ–∫ —É Telegram.)

### 7) –ü–µ—Ä–µ–≤—ñ—Ä—è—î–º–æ —Å—Ç–∞—Ç—É—Å –Ω–∞–≥–∞–¥—É–≤–∞–Ω–Ω—è –ø—ñ—Å–ª—è —á–∞—Å—É publishAt (remind_at)
GET {{baseUrl}}/api/v1/events/{{event_id}}/posts/{{post_id_reminder}}
Authorization: Bearer {{admin_access_token}}

### 7.1) (–û–ø—Ü—ñ–æ–Ω–∞–ª—å–Ω–æ) –í—Å—ñ TELEGRAM-–ø–æ—Å—Ç–∏ –∑—ñ —Å—Ç–∞—Ç—É—Å–æ–º PUBLISHED
GET {{baseUrl}}/api/v1/events/{{event_id}}/posts?status=PUBLISHED&channel=TELEGRAM
Authorization: Bearer {{admin_access_token}}
